<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper	namespace="kr.or.dgit.sw_project.dao.DeliveryMapper">
    
    <resultMap type="Delivery" id="DeliveryResult">
    	<id property="delCode" column="del_code"/>
    	<result property="supplyPrice" column="supply_price"/>
    	<result property="supplyAmount" column="supply_amount"/>
    	<result property="orderDate" column="order_date"/>
    	<result property="delIsExist" column="del_isExist"/>
    	<association property="supplyCompany" resultMap="kr.or.dgit.sw_project.dao.SupplyCompMapper.SupplyCompanyResult"/>
    	<association property="software" resultMap="kr.or.dgit.sw_project.dao.SoftwareMapper.SoftwareResult"/>
    </resultMap>
		

	<!-- Select SQL -->
    <sql id="selectSQL">
		SELECT DISTINCT del.del_code,sc.comp_name,sw.sw_name,del.supply_price,del.supply_amount,
				del.order_date
			FROM software sw
			LEFT OUTER JOIN delivery del ON sw.sw_code = del.sw_code
			LEFT OUTER JOIN supply_company sc ON sc.comp_code = del.comp_code
			LEFT OUTER JOIN category cat ON sw.group_code = cat.group_code
			LEFT OUTER JOIN sale s ON sw.sw_code = s.sw_code
			LEFT OUTER JOIN view_sale_detail sd ON s.sale_code = sd.sale_code
			
	</sql>

	<!-- Where SQL -->
	<sql id="whereSQL">
		<where>
			<if test="delCode != null">
				del_code=#{delCode}
			</if>
		</where>
	</sql>
	    
    <!-- Select By All --> 
    <select id="selectDeliveryByAll" resultMap="DeliveryResult">
    	<include refid="selectSQL" />
    		where del_isExist = true
    		ORDER BY del_code;
    </select>
    
    <!-- Get LastDeliveryCode -->
    <select id="lastDeliveryCode"  resultType="Delivery">
    	select max(del_code)  from delivery;
    </select>
    
    <!-- Insert item -->
    <insert id="insertDeliveryItems" parameterType="Delivery">
    	INSERT INTO delivery(del_code, comp_code, sw_code, supply_price, supply_amount, order_date, del_isExist) VALUES
		(#{delCode}, #{supplyCompany.compCode}, #{software.swCode}, #{supplyPrice}, #{supplyAmount}, #{orderDate}, TRUE)
    </insert>
    
    <!-- Update item -->
    <update id="UpdateItems" parameterType="Delivery">
    	UPDATE delivery
		SET  del_code=#{delCode}, sw_code=#{swCode}, supply_price=#{supplyPrice}, supply_amount=#{supplyAmount}, order_date=#{orderDate}, del_isExist=#{delIsExist}
		WHERE del_code=#{delCode}
    </update>
    
    <!-- Exist item -->
     <update id="existDeliveryItem" parameterType="Delivery">
    	UPDATE delivery
		SET  del_isExist=false
		WHERE del_code=#{delCode}
    </update>
</mapper>